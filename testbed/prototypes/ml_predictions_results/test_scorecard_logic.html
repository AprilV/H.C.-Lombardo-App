<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scorecard Logic Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00d4ff;
        }
        .test-section {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #00d4ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .game {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .correct {
            color: #4ade80;
            font-weight: bold;
        }
        .wrong {
            color: #ff4444;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            background: rgba(0, 212, 255, 0.2);
        }
        .scorecard {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .stat-box {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #4ade80;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .stat-box h3 {
            margin: 0 0 10px 0;
            font-size: 1rem;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .stat-percent {
            color: #4ade80;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <h1>ðŸ“Š ML Predictions Scorecard Logic Test</h1>
    
    <div class="test-section">
        <h2>Test Data: Week 12, 2025</h2>
        <p>Using real API data from <code>/api/ml/predict-week/2025/12</code></p>
        
        <div id="results"></div>
        
        <div class="scorecard">
            <div class="stat-box">
                <h3>ðŸ¤– AI Predictions</h3>
                <div class="stat-value" id="ai-record">-</div>
                <div class="stat-percent" id="ai-percent">-</div>
            </div>
            <div class="stat-box">
                <h3>ðŸŽ° Vegas Spread</h3>
                <div class="stat-value" id="vegas-record">-</div>
                <div class="stat-percent" id="vegas-percent">-</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Detailed Game Analysis</h2>
        <div id="games-table"></div>
    </div>

    <script>
        // Sample data from API (Week 12, 2025)
        const predictions = [
            {
                game_id: 20251120_HOU_BUF,
                away_team: "BUF",
                home_team: "HOU",
                actual_away_score: 19,
                actual_home_score: 23,
                actual_winner: "HOU",
                predicted_winner: "HOU",
                correct: true,
                vegas_spread: -5.5,
                ai_spread: -6.2,
                game_date: "2025-11-20"
            },
            // Add more games as needed for testing
            {
                game_id: 20251120_SEA_MIN,
                away_team: "SEA",
                home_team: "MIN",
                actual_away_score: null,
                actual_home_score: null,
                actual_winner: null,
                predicted_winner: "MIN",
                correct: null,
                vegas_spread: -7.0,
                ai_spread: -12.7,
                game_date: "2025-11-24"
            }
        ];

        // Filter finished games
        const finishedGames = predictions.filter(p => 
            p.actual_home_score !== null && p.actual_home_score !== undefined
        );

        // Count AI correct
        const aiCorrect = finishedGames.filter(p => p.correct === true).length;

        // Count Vegas coverage
        const vegasCovered = finishedGames.filter(p => {
            const actualMargin = p.actual_home_score - p.actual_away_score;
            return actualMargin > p.vegas_spread;
        }).length;

        // Display scorecard
        if (finishedGames.length > 0) {
            const aiPercent = ((aiCorrect / finishedGames.length) * 100).toFixed(1);
            const vegasPercent = ((vegasCovered / finishedGames.length) * 100).toFixed(1);

            document.getElementById('ai-record').textContent = `${aiCorrect} / ${finishedGames.length}`;
            document.getElementById('ai-percent').textContent = `${aiPercent}% Correct`;
            
            document.getElementById('vegas-record').textContent = `${vegasCovered} / ${finishedGames.length}`;
            document.getElementById('vegas-percent').textContent = `${vegasPercent}% Covered`;

            document.getElementById('results').innerHTML = `
                <p><strong>Finished Games:</strong> ${finishedGames.length}</p>
                <p><strong>AI Correct:</strong> ${aiCorrect}</p>
                <p><strong>Vegas Covered:</strong> ${vegasCovered}</p>
            `;
        } else {
            document.getElementById('results').innerHTML = '<p>No finished games yet.</p>';
        }

        // Display detailed table
        let tableHTML = '<table><tr><th>Game</th><th>Score</th><th>Winner</th><th>AI Pred</th><th>AI âœ“</th><th>Vegas Spread</th><th>Margin</th><th>Covered?</th></tr>';
        
        predictions.forEach(p => {
            const isFinished = p.actual_home_score !== null;
            if (isFinished) {
                const margin = p.actual_home_score - p.actual_away_score;
                const covered = margin > p.vegas_spread;
                const aiCheck = p.correct ? 'âœ“' : 'âœ—';
                const aiClass = p.correct ? 'correct' : 'wrong';
                const coveredCheck = covered ? 'âœ“' : 'âœ—';
                const coveredClass = covered ? 'correct' : 'wrong';

                tableHTML += `
                    <tr>
                        <td>${p.away_team} @ ${p.home_team}</td>
                        <td>${p.actual_away_score} - ${p.actual_home_score}</td>
                        <td>${p.actual_winner}</td>
                        <td>${p.predicted_winner}</td>
                        <td class="${aiClass}">${aiCheck}</td>
                        <td>${p.vegas_spread > 0 ? '+' : ''}${p.vegas_spread}</td>
                        <td>${margin > 0 ? '+' : ''}${margin}</td>
                        <td class="${coveredClass}">${coveredCheck}</td>
                    </tr>
                `;
            } else {
                tableHTML += `
                    <tr style="opacity: 0.5;">
                        <td>${p.away_team} @ ${p.home_team}</td>
                        <td colspan="7">Not finished yet</td>
                    </tr>
                `;
            }
        });
        
        tableHTML += '</table>';
        document.getElementById('games-table').innerHTML = tableHTML;

        // Explanation
        document.getElementById('games-table').innerHTML += `
            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                <h3>Spread Coverage Explanation</h3>
                <p><strong>Current Logic:</strong> <code>actualMargin > vegas_spread</code></p>
                <p><strong>Example:</strong> HOU -5.5 (home favored by 5.5 points)</p>
                <p>Final: HOU 23, BUF 19 â†’ Margin = +4</p>
                <p>Logic check: 4 > -5.5 = TRUE</p>
                <p><strong>But:</strong> HOU needed to win by MORE than 5.5 (i.e., by 6+). They only won by 4.</p>
                <p style="color: #ff4444;"><strong>Issue:</strong> This logic says HOU covered when they actually didn't!</p>
                <p style="color: #00d4ff;"><strong>Possible Fix:</strong> Need to research proper NFL spread calculation</p>
            </div>
        `;
    </script>
</body>
</html>
